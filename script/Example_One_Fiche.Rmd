---
title: ''
author: ''
date: ''
output:
  word_document:
    number_sections: no
    reference_docx: ../output/Template_matu.docx
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Ce script est la version fiche maturité exemple pour 1 espèce.

#Il contient les codes pour fournir une fiche d'identification de toutes les phases de maturité d'une espèce pour les femelles et pour les mâles.

#La fiche est divisé en 2 feuilles recto-verso : l'une correspondant aux femelles et l'autre correspondant aux mâles.

#Vous retrouverez des indications annotées pour comprendre et savoir quelles informations remplir à chaque étape.

#Ce script est applicable à toutes les espèces dont les photos sont présentes dans le jeu de données.


#Le "nom scientifique" des Gadidées est "Gadidae sp."
#Le "nom scientifique" des Poissons plats est "Flat fish sp."



#Au niveau du choix des photos, voici les correspondances des codes d'identification : 
# EXT = gonades à l'extérieur de la cavité interne du poisson
# EXT OUV = gonades ouverte à l'extérieur de la cavité interne du poisson 
# INT = gonades à l'intérieur de la cavité interne du poisson SANS les organes autour
# INT ORG = gonades à l'intérieur de la cavité interne du poisson AVEC les organes autour

```

```{r library, echo=FALSE}

#Librairie utilisées
library(readxl)
library(dplyr, warn.conflicts = FALSE)
library(knitr)
library(pander)
library(kableExtra, warn.conflicts = FALSE)

#Import des jeux de données
Dataphoto <- read_excel("../data/photo_mat.xlsx",sheet=1)
#Dataphoto = jeu de données avec les photos

Datascale <- read_excel("../data/matu_scale.xlsx",sheet=1)
#Datascale = jeu de données avec les phases de maturité

Datataille <- read_excel("../data/matu_scale.xlsx",sheet=4)
#Datataille = jeu de données avec les tailles de 1ère maturité


```


# MATURITE
## Noter ici nom commun de l'espèce
## *Noter ici nom scientifique* (Noter ici code ID tutti)


```{r pressure, echo=FALSE,fig.align='right'}

#La première fiche correspond aux femelles

#Affichage du symbole du sexe

knitr::include_graphics('../data/Female sign.png')

```


```{r PHOTOINDIV, echo=FALSE,fig.align='right', out.width = '150px'}


#Objet PHOTO avec la photo du poisson
PHOTO<-Datataille %>% filter(Species=="Flat fish sp.",Sexe=="F")
PHOTO <- PHOTO$Photo

knitr::include_graphics(PHOTO,)

```




```{r Ftaille, echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

TAILLE<-Datataille %>% filter(Species=="Flat fish sp.",Sexe=="F")
TAILLE <- TAILLE$Fishbase

#Création d'un tableau affichant la taille de 1ère maturité
tabT <- data.frame(x=TAILLE )
colnames(tabT) <- c("Taille de 1ère maturité")

#cat("  \n####", "Taille de 1ère maturité")
knitr::kable(tabT, align='c', position='c', format='simple')%>%kable_styling("striped")%>%column_spec(1,width="3cm")#Amélioration du tableau





#Création du tableau
#tbl_img <-data.frame(Espèce = PHOTO, Sexe = '../data/Female sign.png', name = TAILLE)
#colnames(tbl_img)<-c("Photo","Sexe","Taille de 1ère maturité")

#kable(tbl_img)

#knitr::kable(tbl_img, booktabs =T,align="c", valign = "c")%>%column_spec(2,image ="../data/Fsign.png")%>% kable_styling(full_width = F, position = "left")%>%column_spec(3,bold=T)%>%column_spec(1,image =PHOTO, width="3cm")




```

### A - IMMATURE

```{r FphaseA text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce premier chunk est destiné à la phase A

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="A - IMMATURE",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="A - IMMATURE", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link

#Insertion des photos
knitr::include_graphics(ASBType,)


```

### B - EN DEVELOPPEMENT

```{r FphaseB text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce chunk est destiné à la phase B

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="B - EN DEVELOPPEMENT",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="B - EN DEVELOPPEMENT", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link

#Insertion des photos
knitr::include_graphics(ASBType,)


```

### C - EN PONTE

```{r FphaseC text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce chunk est destiné à la phase C

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="C - EN PONTE",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="C - EN PONTE", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link

#Insertion des photos
knitr::include_graphics(ASBType,)


```

###### Références/Photos  
ICES (**WKASMSF** 2018 & **WKMATCH** 2012)  
IFREMER (CGFS, EVHOE, IBTS)  



\newpage

### D - REGRETION/REGENERATION

```{r FphaseD text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce chunk est destiné à la phase D

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="D - REGRETION/REGENERATION",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="D - REGRETION/REGENERATION", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link

#Insertion des photos
knitr::include_graphics(ASBType,)

```

### E - OMISSION DE PONTE

```{r FphaseE text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce chunk est destiné à la phase E

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="E - OMISSION DE PONTE",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="E - OMISSION DE PONTE", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link

#Insertion des photos
knitr::include_graphics(ASBType,)

```

### F - ANORMAL

```{r FphaseF text,echo= FALSE, out.width = '250px', results='asis', warning=FALSE}

#Ce chunk est destiné à la phase F

#Extraction des commentaires liées a la phase
textASB<-Datascale %>% filter(Species=="Flat fish sp.",Phase=="F - ANORMAL",Sexe=="F")
textASB <- textASB$Text

#Création d'un tableau regroupant les commentaires
tab <- data.frame(x = textASB)
colnames(tab) <- c(" ")
kable(tab)#Amélioration du tableau (facultatif)



#Partie de sélection des photos

#Extraction des photos correspondant a la phase
ASB<-Dataphoto %>% filter(Species=="Flat fish sp.",Phase=="F - ANORMAL", Sexe=="F")

#Extraction des photos correspondant aux types de photos choisies
ASBType <- filter(ASB,Fiches=='oui'| Fiches=='na')
permutation <- order(ASBType$Fiches, decreasing = TRUE)
ASBType <- head(ASBType[permutation,])
if(ASBType$Fiches=='oui') {
 ASBType <- filter(ASBType, Fiches != "na") 
}
ASBType<-ASBType$Link
#Insertion des photos
knitr::include_graphics(ASBType,)

```


###### Références/Photos  
ICES (**WKASMSF** 2018 & **WKMATCH** 2012)  
IFREMER (CGFS, EVHOE, IBTS)  
